/**
 * list\u5de6\u53f3\u9009\u62e9
 * @fileOverview
 * @ignore
 */define("bui/extensions/multiselect/multilist",["bui/common","bui/list"],function(e){function i(e,n,r){t.isFunction(e.set)?e.set(n,r):e[n]=r}var t=e("bui/common"),n=t.Component,r=e("bui/list"),s=t.prefix,o=s+"multilist-source",u=s+"multilist-target",a=s+"multilist-btn-right",f=s+"multilist-btn-left",l=n.Controller.extend({renderUI:function(){var e=this,t=e.get("source"),n=e.get("target");t=e._initControl(t,o),n=e._initControl(n,u),t.render(),n.render(),e.set("source",t),e.set("target",n)},_initControl:function(e,t){var n=this,r=n.get("el");return e.isController?(e.set("render",r.find("."+t)),e):(e.render=r.find("."+t),n._createControl(e))},_createControl:function(e){if(e.isController)return e;var t=e.multipleSelect||this.get("multipleSelect"),r=e.xclass||t?"listbox":"simple-list";return e.xclass=r,n.create(e,this)},bindUI:function(){var e=this,t=e.get("el"),n=e.get("source"),r=e.get("target"),i=t.find("."+a),s=t.find("."+f);i.on("click",function(t){var i=n.getSelection();e.fire("selected",{items:i})!==!1&&(n.removeItems(i),r.addItems(i))}),s.on("click",function(t){var i=r.getSelection();e.fire("unselected",{items:i})!==!1&&(r.removeItems(i),n.addItems(i))}),n.on("dblclick",function(t){var i=$(t.domTarget).closest("li"),s=n.getItemByElement(i);e.fire("selected",{items:[s]})!==!1&&(n.removeItem(s),r.addItem(s))}),r.on("dblclick",function(t){var i=$(t.domTarget).closest("li"),s=r.getItemByElement(i);e.fire("unselected",{items:[s]})!==!1&&(r.removeItem(s),n.addItem(s))})},_uiSetStore:function(e){var n=this,r=n.get("target"),i=r.get("idField");e.filter(function(e){var n=r.getItems(),s=!0;return t.each(n,function(t){if(t[i]===e[i])return s=!1,!1}),s})}},{ATTRS:{source:{value:{elCls:"bui-select-list"},shared:!1},target:{value:{elCls:"bui-select-list"},shared:!1},store:{setter:function(e){return i(this.get("source"),"store",e),e}},items:{setter:function(e){var n=new t.Data.Store({data:e});return this.set("store",n),e}},url:{setter:function(e){if(!e)return;var n=new t.Data.Store({url:e,autoLoad:!0});return this.set("store",n),e}},tpl:{value:'<div class="row"><div class="span5 '+o+'"></div>'+'<div class="span2 bui-multilist-action centered">'+'<p><button  class="button button-small '+a+'" type="button">&gt;&gt;</button></p>'+'<p><button  class="button button-small '+f+'" type="button">&lt;&lt;</button></p>'+"</div>"+'<div class="span5 '+u+'"></div>'+"</div>"}}},{xclass:"multilist"});return l}),define("bui/extensions/multiselect/multilistpicker",["bui/overlay","bui/picker"],function(e){var t=e("bui/overlay").Dialog,n=e("bui/picker").Mixin,r=t.extend([n],{setSelectedValue:function(e){var t=this,n=t.get("innerControl"),r=n.get("store");if(!this.get("isInit")&&e){e=e.split(",");function i(){t._syncValue(e),r.off("load",i)}r.get("url")?r.on("load",i):t._syncValue(e)}},_syncValue:function(e){var t=this,n=t.get("innerControl"),r=t._getTextField(),i=n.get("source").get("idField"),s=n.get("store"),o=s.getResult(),u=[],a=[];BUI.each(o,function(t){$.inArray(t[i],e)!==-1&&(u.push(t),a.push(t.text))}),$(r).val(a.join(",")),BUI.each(u,function(e){s.remove(e)}),n.get("target").setItems(u)},getSelectedValue:function(){var e=this,t=e.get("innerControl"),n=t.get("target");return e._getItemsValue(n)},getSelectedText:function(){var e=this,t=e.get("innerControl"),n=t.get("target");return e._getItemsText(n)},_getItemsText:function(e,t){return t||(t=e.get("items")),$.map(t,function(t){return e.getItemText(t)})},_getItemsValue:function(e,t){var n=e.get("idField");return t||(t=e.get("items")),$.map(t,function(t){return e.getValueByField(t,n)})}},{ATTRS:{success:{value:function(){var e=this;e.get("innerControl").fire(e.get("changeEvent")),this.close()}}}},{xclass:"multilist-picker"});return r}),define("bui/extensions/multiselect/multiselect",["bui/common","bui/extensions/multiselect/multilist","bui/extensions/multiselect/multilistpicker","bui/extensions/search"],function(e){var t=e("bui/common"),n=t.Component,r=e("bui/extensions/multiselect/multilist"),i=e("bui/extensions/multiselect/multilistpicker"),s=e("bui/extensions/search"),o=t.prefix+"select-input",u=n.Controller.extend({initializer:function(){var e=this,t=e.get("search"),n=e.get("searchTpl"),i={},o;t&&(n&&(i.tpl=n),t=new s(i),o=[t]);var u=new r({items:e.get("items"),url:e.get("url"),plugins:o});e.set("multilist",u)},renderUI:function(){var e=this,t=e.get("el"),n=t.find("."+o),r=e.get("multilist"),s=new i({trigger:n,autoRender:!0,textField:n,valueField:e.get("valueField"),children:[r]});e.set("picker",s),e.set("textField",n)},bindUI:function(){var e=this,t=e.get("multilist");t.on("selected",function(t){var n=t.items;return e.fire("selected",{items:n})}),t.on("unselected",function(t){var n=t.items;return e.fire("unselected",{items:n})})}},{ATTRS:{elCls:{value:"bui-select"},searchTpl:{},search:{},url:{},items:{},source:{getter:function(){return this.get("multilist").get("source")}},target:{getter:function(){return this.get("multilist").get("target")}},valueField:{setter:function(e){return $(e)}},textField:{},tpl:{view:!0,value:'<input type="text" readonly="readonly" class="'+o+'"/><span class="x-icon x-icon-normal"><i class="icon icon-caret icon-caret-down"></i></span>'}}},{xclass:"multiselect"});return u}),define("bui/extensions/multiselect",["bui/common","bui/extensions/multiselect/multilist","bui/extensions/multiselect/multilistpicker","bui/extensions/multiselect/multiselect","bui/extensions/search"],function(e){var t=e("bui/common"),n=e("bui/extensions/multiselect/multiselect");return n});
